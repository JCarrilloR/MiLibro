# InstalaciÃ³n y ejecuciÃ³n de Picrust2

DescripciÃ³n del capÃ­tulo


## InstalaciÃ³n en Mac (procesador intel)

### Instalando conda, nuevo ambiente picrust2, se crean canales, y se instala picrust2

```

curl -L -O https://repo.anaconda.com/miniconda/Miniconda3-latest-MacOSX-x86_64.sh

bash Miniconda3-latest-MacOSX-x86_64.sh

conda --version

Descargar el picrust2-env.yaml oficial

cd ~
curl -L -o picrust2-env.yaml \
  https://raw.githubusercontent.com/picrust/picrust2/master/picrust2-env.yaml

conda env create -f picrust2-env.yaml -n picrust2


conda activate picrust2




Â´Â´Â´


### Verificando picrust2, 

conda activate picrust2

picrust2_pipeline.py -h


### Corriendo primer ejemplo. Archivos de entrada ASVs_counts.tsv (se agrega "OTU" en primer linea, separado por un tabulador) y archivo ASVs.fa. El current directory debe ser donde estÃ¡n los arhivos .fa y .tsv


cd picrust2_test/  

picrust2_pipeline.py \
  -s ASVs.fa \
  -i ASVs_counts.tsv \
  -o picrust2_results \
  - p 4


#### picrust2_pipeline.py
Es el pipeline principal de PICRUSt2, un flujo completo que:
Coloca las ASVs en un Ã¡rbol filogenÃ©tico de referencia.
Predice funciones (KO, EC, MetaCyc pathways).
Calcula el valor NSTI para evaluar la confiabilidad de la predicciÃ³n.
Genera las tablas funcionales por muestra (estratificadas y no estratificadas).

#### -s asv_seqs.fna
Archivo FASTA con las secuencias ASV.
Contiene las secuencias representativas generadas por DADA2 o QIIME2.
Cada encabezado (>ASV_1, >ASV_2, etc.) debe coincidir exactamente con los IDs en la tabla de conteos.
Deben ser secuencias del gen 16S (PICRUSt2 no funciona con ITS u otros marcadores).
Debe tener formato FASTA estÃ¡ndar.

#### -i asv_table.tsv
Tabla de abundancias (TSV) con los conteos por ASV.
Primera columna: ID del ASV.
Columnas siguientes: cada muestra.
SeparaciÃ³n por tabuladores.
Debe coincidir con los IDs de FASTA.

#### -o picrust2_results
Carpeta donde se guardarÃ¡n todos los resultados.
El pipeline crea automÃ¡ticamente un directorio con subcarpetas y archivos como:
KO_metagenome_out/ â†’ Predicciones KO (KEGG Orthologs)
EC_metagenome_out/ â†’ Enzyme Commission numbers
pathways_out/ â†’ Predicciones de rutas MetaCyc
marker_predicted_and_nsti.tsv.gz â†’ Valores NSTI por ASV
out.tre â†’ Ãrbol filogenÃ©tico con colocaciÃ³n de ASVs
pipeline_log.txt â†’ Registro completo del anÃ¡lisis

#### -p 4
NÃºmero de nÃºcleos/threads usados.
Acelera procesos intensivos como HMMER y EPA-NG.
RecomendaciÃ³n general:
Mac Intel 4 nÃºcleos â†’ -p 4
Mac con 8 nÃºcleos â†’ -p 8
Servidores â†’ usar tantos como tengas disponibles


### Resultados generados por PICRUSt2
PICRUSt2 produce un conjunto de archivos y carpetas que contienen las predicciones funcionales derivadas de datos taxonÃ³micos (ASVs/OTUs), su colocaciÃ³n filogenÃ©tica y la inferencia de rutas metabÃ³licas. Estos resultados se organizan principalmente en el directorio especificado con -o.
A continuaciÃ³n se describen los componentes mÃ¡s importantes del anÃ¡lisis.

ðŸ”¹ 1. Archivo del Ã¡rbol filogenÃ©tico
out.tre
Contiene la colocaciÃ³n de las ASVs dentro del Ã¡rbol de referencia de PICRUSt2 (basado en genes marcadores 16S).
Generado mediante EPA-NG y GAPPA, que posicionan las nuevas secuencias en un Ã¡rbol fijo.
Es esencial para la predicciÃ³n funcional basada en ancestrÃ­a filogenÃ©tica.

ðŸ”¹ 2. Valores de NSTI (Nearest Sequenced Taxon Index)
marker_predicted_and_nsti.tsv.gz
Proporciona para cada ASV el valor NSTI, un indicador de la confiabilidad de las predicciones:
Valores bajos â†’ alta cercanÃ­a a genomas secuenciados â†’ predicciones mÃ¡s confiables.
Valores altos â†’ ASVs divergentes â†’ menor precisiÃ³n potencial.
Incluye la abundancia predicha del marcador genÃ©tico (16S).

ðŸ”¹ 3. Predicciones funcionales por genes (KO y EC)
ðŸ“ a) KO (KEGG Orthologs)
Carpeta: KO_metagenome_out/
Archivos principales:
pred_metagenome_unstrat.tsv.gz
Tabla de abundancia predicha de genes KO por muestra no estratificada.
Filas = genes KO
Columnas = muestras
pred_metagenome_strat.tsv.gz
Tabla estratificada, donde cada fila representa
KO + ASV que lo aporta.
Ãštil para identificar cuÃ¡les ASVs contribuyen a cada funciÃ³n.
ðŸ“ b) EC (Enzyme Commission numbers)
Carpeta: EC_metagenome_out/
AnalogÃ­a a KO:
pred_metagenome_unstrat.tsv.gz
â†’ Abundancias totales de enzimas EC por muestra.
pred_metagenome_strat.tsv.gz
â†’ AportaciÃ³n de cada ASV a cada funciÃ³n EC.
Las matrices EC son una forma complementaria a KO para evaluar funciones.

ðŸ”¹ 4. PredicciÃ³n de rutas metabÃ³licas (MetaCyc)
ðŸ“ pathways_out/
Esta carpeta contiene la inferencia de rutas metabÃ³licas completas basada en la combinaciÃ³n de funciones KO/EC.
Archivos importantes:
path_abun_unstrat.tsv.gz
â†’ Abundancia total de cada ruta metabÃ³lica.
Ejemplo de rutas: biosÃ­ntesis de aminoÃ¡cidos, degradaciÃ³n de xilosa, fermentaciÃ³n butÃ­rica.
path_abun_strat.tsv.gz
â†’ Ruta + ASV contribuyente (estratificado).
path_abun_unstrat_descriptions.tsv
â†’ Tabla con descripciones humanas de cada metapathway (nombre completo).
pathway_map.tsv
â†’ Mapa entre KOs/ECs y rutas MetaCyc.

ðŸ”¹ 5. Alineamientos intermedios y diagnÃ³sticos
intermediate/
Contiene archivos generados durante el proceso:
Alineamientos HMMER
ColocaciÃ³n intermediaria de EPA-NG
Tablas transformadas
Resultados preliminares de los modelos de predicciÃ³n
Aunque no suelen emplearse directamente en anÃ¡lisis, son Ãºtiles para depuraciÃ³n o auditorÃ­a del pipeline.

ðŸ”¹ 6. BitÃ¡cora del anÃ¡lisis
pipeline_log.txt
Incluye:
Todos los comandos ejecutados
Tiempos de procesamiento
Mensajes de advertencia
VersiÃ³n del software
Es esencial para documentaciÃ³n y reproducibilidad.

### Warnings de resultados. Normalmente resulta en estos warnings, el significado es el siguiente

Warning: There was only one file for the function: EC
Maybe that's fine if you used custom traits or there were no sequences matching one of the domains.
Warning: There was only one file for the function: KO
Maybe that's fine if you used custom traits or there were no sequences matching one of the domains.
All ASVs were below the max NSTI cut-off of 2.0 and so all were retained for downstream analyses.

All ASVs were below the max NSTI cut-off of 2.0 and so all were retained for downstream analyses.


ðŸ”¹ 1) â€œThere was only one file for the function: EC / KOâ€
PICRUSt2 normalmente puede combinar resultados de dos dominios:
Bacterias
Arqueas
Cuando el script intenta juntar ambos y solo encuentra uno de los dos, te saca ese warning:
En la prÃ¡ctica significa:
ðŸ‘‰ â€œSolo hubo predicciones para un dominio (por ejemplo, solo bacterias)â€.
Esto es muy comÃºn si:
Tus ASVs son sobre todo bacterianas (16S tÃ­pico)
O si la base de referencia arqueal no tuvo matches

ðŸ”¹ 2) â€œAll ASVs were below the max NSTI cut-off of 2.0â€¦â€
Este mensaje es muy bueno:
PICRUSt2 calcula para cada ASV un valor NSTI (Nearest Sequenced Taxon Index).
Cuanto mÃ¡s bajo, mÃ¡s â€œcercaâ€ estÃ¡ tu ASV de un genoma de referencia secuenciado.
El pipeline descarta ASVs con NSTI muy alto (por default > 2.0).



Contenido
